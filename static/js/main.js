// Generated by CoffeeScript 1.3.3

/* -------------------------------------------- 
     Begin game.coffee 
--------------------------------------------
*/


(function() {
  var $game, $game_cover, $last_active, $main_menu, $menus, $pause_menu, $time, GameViewModel, time_changed, viewModel;

  $menus = $('#menus');

  $game = $('#game');

  $game_cover = $('#game-cover');

  $pause_menu = $('#pause-menu');

  $main_menu = $('#main-menu');

  $time = $('.time .inner');

  GameViewModel = function() {
    var self;
    self = this;
    self.paused = ko.observable(false);
    self.time = ko.observable(0);
    self.difficulty = ko.observable(3);
    self.minutes = ko.computed(function() {
      var minutes;
      minutes = parseInt(self.time() / 60, 10);
      if (minutes < 10) {
        minutes = "0" + minutes;
      }
      return minutes;
    });
    self.seconds = ko.computed(function() {
      var seconds;
      seconds = parseInt(self.time() % 60, 10);
      if (seconds < 10) {
        seconds = "0" + seconds;
      }
      return seconds;
    });
    self.formatted_time = ko.computed(function() {
      return self.minutes() + ":" + self.seconds();
    });
  };

  viewModel = new GameViewModel();

  ko.applyBindings(viewModel);

  time_changed = function() {
    if (!viewModel.paused()) {
      return viewModel.time(viewModel.time() + 1);
    }
  };

  setInterval(time_changed, 1000);

  window.start_game = function(difficulty) {
    viewModel.time(0);
    viewModel.paused(false);
    viewModel.difficulty(difficulty);
  };

  $('.pause').click(function() {
    window.forward_to($pause_menu);
    $game.addClass('paused');
    $game_cover.show();
    $menus.fadeIn();
    viewModel.paused(true);
    return false;
  });

  $('.resume').click(function() {
    $game.removeClass('paused');
    $game_cover.hide();
    $menus.fadeOut();
    viewModel.paused(false);
    return false;
  });

  $('.confirm-exit-game').click(function() {
    $game_cover.hide();
    $game.fadeOut();
    return window.backwards_to($main_menu);
  });

  /* -------------------------------------------- 
       Begin tutorial.coffee 
  --------------------------------------------
  */


  window.start_tutorial = function() {
    return window.start_game(3);
  };

  /* -------------------------------------------- 
       Begin menu.coffee 
  --------------------------------------------
  */


  $menus = $('#menus');

  $game = $('#game');

  $last_active = $('.overlay-window.active');

  window.forward_to = function($element) {
    $last_active = $('.overlay-window.active');
    if ($last_active.attr('id') === $element.attr('id')) {
      return;
    }
    if ($element.prevAll('.overlay-window.active').length === 0) {
      $menus.css({
        'left': '+=600px'
      });
    }
    $last_active.after($element).removeClass('active');
    $element.addClass('active');
    return $menus.animate({
      "left": "-=600px"
    });
  };

  window.backwards_to = function($element) {
    $last_active = $('.overlay-window.active');
    if ($last_active.attr('id') === $element.attr('id')) {
      return;
    }
    if ($element.prevAll('.overlay-window.active').length > 0) {
      $menus.css({
        'left': '-=600px'
      });
    }
    $last_active.before($element).removeClass('active');
    $element.addClass('active');
    return $menus.animate({
      "left": "+=600px"
    });
  };

  window.show_menu = function(menu_target) {
    var $menu_target;
    if (menu_target === 'previous') {
      window.backwards_to($last_active);
      return;
    }
    $menu_target = $(menu_target);
    return window.forward_to($menu_target);
  };

  $('li[data-menu]').click(function() {
    var $this, menu_target;
    $this = $(this);
    menu_target = $this.data('menu');
    return window.show_menu(menu_target);
  });

  $('.start-tutorial').click(function() {
    window.start_tutorial();
    $menus.fadeOut();
    return $game.fadeIn();
  });

}).call(this);
